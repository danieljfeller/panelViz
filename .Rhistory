formatStyle(c('VLS', 'drugAbuse', 'etohAbuse', 'DM',
'UnstableHousing', 'NewDx', 'HCV', 'CVD', 'CKD',
'HTN', 'Depression', 'Anxiety','Schizophrenia')[BinarySelection],
backgroundColor = styleEqual(c('No', 'Yes'), c('#a1d99b', '#fc9272')),
color = 'white',
fontWeight = 'bold') %>%
# add colors to continuous variables
formatStyle(c('cd4')[cd4Selection],
backgroundColor = styleInterval(cd4_brks, gradientColors),
color = 'white',
fontWeight = 'bold') %>%
formatStyle(c('hba1c')[HbA1cSelection],
backgroundColor = styleInterval(hba1c_brks, gradientColors),
color = 'white',
fontWeight = 'bold') %>%
formatStyle(c('office_visits')[officeSelection],
backgroundColor = styleInterval(office_brks, gradientColors),
color = 'white',
fontWeight = 'bold') %>%
formatStyle(c('er_visits')[erSelection],
backgroundColor = styleInterval(er_brks, gradientColors),
color = 'white',
fontWeight = 'bold') %>%
formatStyle(c('inpatient_admissions')[inpatientSelection],
backgroundColor = styleInterval(inpatient_brks, gradientColors),
color = 'white',
fontWeight = 'bold') %>%
# add color to patient names
formatStyle('Name','rowname',
backgroundColor = styleInterval(patient_brks, patientColors),
color = 'white',
fontWeight = 'bold')
})
#############
# hex plot #
############
output$hex_plot <- renderPlot({
# get MAGIQ score (rankings) for each patient
MAGIQscore <- computeWeightedSum(df, input$selected)
df$weightRank <- MAGIQscore[,1]
ggplot(data = df, aes(x=i, y=j, fill = weightRank))+
geom_hex(stat='identity')+
scale_fill_gradientn(colours = ColRamp)+
theme_bw()+
theme(aspect.ratio = 0.5)+
coord_flip()+
theme(legend.position="left")+
labs(fill='Patient Priority Score') +
theme(axis.line=element_blank(),axis.text.x=element_blank(),
axis.text.y=element_blank(),axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),legend.position="none",
panel.background=element_blank(),panel.border=element_blank(),panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),plot.background=element_blank())
})
# retrieve values to be reactively presented in UI
output$name <- renderPrint({
# retrieve coordinates from user's cursor
hover <- input$plot_hover
# returns row from dataframe hover coordinators
name <- nearPoints(df, hover, threshold = 10)$Name[[1]]
# print name
cat(sprintf("<b><font size=4>%s</b>",name))
})
# renders reactive output variable
output$dynamicName <- renderUI({
# only proceed if mouse coordinates exist
req(input$plot_hover)
htmlOutput("name", inline = TRUE)
})
# retrieve values to be reactively presented in UI
output$vals <- renderPrint({
# retrieve coordinates from user's cursor
hover <- input$plot_hover
# returns row from dataframe hover coordinators
df <- nearPoints(df, hover, threshold = 10) %>% select(c('Name', input$selected))
# print variables
for (colIndex in 2:ncol(df)){
cat(sprintf("<b><font size=4>%s:</b> <font size=4>%s<br>", names(df)[colIndex], df[1,colIndex]))
}
})
# renders reactive output variables
output$dynamicVals <- renderUI({
# only proceed if mouse coordinates exist
req(input$plot_hover)
htmlOutput("vals", inline = TRUE)
})
}
#####################
# run the shiny app #
#####################
shinyApp(ui = ui, server = server)
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('consolidated_registry_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
df
df %>% select('unstable_housing')
names(df)
df %>% select('office_visits')
runApp('panelViz_app.R')
df %>% select("office_visits")
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
test1 = computeWeightedSum(df, c("VLS", "office_visits"))
test2 = computeWeightedSum(df, c("office_visits"))
test1
type(test1)
str(test1)
str(test2)
test2
unlist(test1)
dim(test1)
dim(test2)
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
dim(test1)
dim(test2)
dim(test2) == NULL
dim(test2) == NA
is.null(dim(test2))
is.null(dim(test1))
runApp('panelViz_app.R')
runApp('panelViz_app.R')
computeWeightedSum(df, c("UnstableHousing"))
df$UnstableHousing
df$UnstableHousing
computeWeightedSum(df, c("UnstableHousing"))
computeWeightedSum(df, c("cd4"))
computeWeightedSum(df, c("UnstableHousing"))
yes2one(df$UnstableHousing)
standard_range()
standard_range(UnstableHousing)
standard_range(yes2one(df$UnstableHousing))
standard_range(yes2one(df$HCV))
unique(df$HCV)
unique(df$UnstableHousing)
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('basic_registry_app.R')
runApp('consolidated_registry_app.R')
runApp('panelViz_app.R')
runApp('basic_registry_app.R')
df$cd4
runApp('panelViz_app.R')
runApp('panelViz_app.R')
colnames(df)
df <- read.csv('data/ehr_dataset.csv', fill = TRUE) %>%
mutate(Name = name,
VLS = toFactor(vls),
DM = toFactor(dx_diabetes),
DrugAbuse =toFactor(dx_alcoholism),
AlcoholAbuse = toFactor(dx_drug_abuse),
UnstableHousing = toFactor(unstable_housing),
NewDx = toFactor(new_dx),
HCV = toFactor(dx_hcv),
HTN = toFactor(dx_hypertension),
CVD = toFactor(dx_cardiovascular.disease),
CKD = toFactor(dx_ckd),
Depression = toFactor(dx_depression),
Anxiety = toFactor(dx_anxiety),
Schizophrenia = toFactor(dx_schizophrenia),
OfficeVisits = office_visits,
ERvisits = er_visits,
InpatientAdmits = inpatient_admissions,
HbA1c = hba1c,
CD4count = cd4
)
df <- df[!duplicated(df),]
df <- df[,c('Name',"VLS","DM","DrugAbuse","AlcoholAbuse","UnstableHousing","NewDx","HCV","HTN","CVD",
"CKD","Depression","Anxiety","Schizophrenia","HbA1c", "CD4count", "OfficeVisits", "ERvisits",
"InpatientAdmits")]
df <- df[sample(nrow(df)), ]
colnames(df)
runApp('panelViz_app.R')
runApp('consolidated_registry_app.R')
runApp('consolidated_registry_app.R')
?sidebarPanel
runApp('consolidated_registry_app.R')
runApp('consolidated_registry_app.R')
library(shiny); runApp('basic_registry_app.R')
mylist <- c(1,2,3,4)
names(mylist) <- c('first', 'second', 'third', 'fourth')
mylist['first']
mylist['first'][1]
mylist['first']*10
mylist[1]
mylist[0]
mylist[2]
mylist <- c(1,3,6,0)
mylist['first']
names(mylist) <- c('first', 'second', 'third', 'fourth')
mylist['first']
mylist['third']
mylist[3]
rawDF <- read.csv('data/ehr_dataset.csv')
df <- read.csv('data/ehr_dataset.csv', fill = TRUE) %>%
mutate(Name = name,
VLS = toFactor(vls),
DM = toFactor(dx_diabetes),
DrugAbuse =toFactor(dx_alcoholism),
AlcoholAbuse = toFactor(dx_drug_abuse),
UnstableHousing = toFactor(unstable_housing),
NewDx = toFactor(new_dx),
HCV = toFactor(dx_hcv),
HTN = toFactor(dx_hypertension),
CVD = toFactor(dx_cardiovascular.disease),
CKD = toFactor(dx_ckd),
Depression = toFactor(dx_depression),
Anxiety = toFactor(dx_anxiety),
Schizophrenia = toFactor(dx_schizophrenia),
OfficeVisits = office_visits,
ERvisits = er_visits,
InpatientAdmits = inpatient_admissions,
HbA1c = hba1c,
CD4count = cd4
)
# remove duplicate patients
df <- df[!duplicated(df),]
# care indiciators for the tool
df <- df[,c('Name',"VLS","DM","DrugAbuse","AlcoholAbuse","UnstableHousing","NewDx","HCV","HTN","CVD",
"CKD","Depression","Anxiety","Schizophrenia","HbA1c", "CD4count", "OfficeVisits", "ERvisits",
"InpatientAdmits")]
# shuffle order of dataframe
df <- df[sample(nrow(df)), ]
# get all cvariable names (excluding name)
variables = colnames(df)[-c(1:length(colnames))]
rawDF <- read.csv('data/ehr_dataset.csv')
df <- read.csv('data/ehr_dataset.csv', fill = TRUE) %>%
mutate(Name = name,
VLS = toFactor(vls),
DM = toFactor(dx_diabetes),
DrugAbuse =toFactor(dx_alcoholism),
AlcoholAbuse = toFactor(dx_drug_abuse),
UnstableHousing = toFactor(unstable_housing),
NewDx = toFactor(new_dx),
HCV = toFactor(dx_hcv),
HTN = toFactor(dx_hypertension),
CVD = toFactor(dx_cardiovascular.disease),
CKD = toFactor(dx_ckd),
Depression = toFactor(dx_depression),
Anxiety = toFactor(dx_anxiety),
Schizophrenia = toFactor(dx_schizophrenia),
OfficeVisits = office_visits,
ERvisits = er_visits,
InpatientAdmits = inpatient_admissions,
HbA1c = hba1c,
CD4count = cd4
)
# remove duplicate patients
df <- df[!duplicated(df),]
# care indiciators for the tool
df <- df[,c('Name',"VLS","DM","DrugAbuse","AlcoholAbuse","UnstableHousing","NewDx","HCV","HTN","CVD",
"CKD","Depression","Anxiety","Schizophrenia","HbA1c", "CD4count", "OfficeVisits", "ERvisits",
"InpatientAdmits")]
# shuffle order of dataframe
df <- df[sample(nrow(df)), ]
# get all cvariable names (excluding name)
variables = colnames(df)[-c(1:length(colnames))]
variables
# get all cvariable names (excluding name)
variables = colnames(df)[-c(1:length(colnames))]
variables
df <- read.csv('data/ehr_dataset.csv', fill = TRUE) %>%
mutate(Name = name,
VLS = toFactor(vls),
DM = toFactor(dx_diabetes),
DrugAbuse =toFactor(dx_alcoholism),
AlcoholAbuse = toFactor(dx_drug_abuse),
UnstableHousing = toFactor(unstable_housing),
NewDx = toFactor(new_dx),
HCV = toFactor(dx_hcv),
HTN = toFactor(dx_hypertension),
CVD = toFactor(dx_cardiovascular.disease),
CKD = toFactor(dx_ckd),
Depression = toFactor(dx_depression),
Anxiety = toFactor(dx_anxiety),
Schizophrenia = toFactor(dx_schizophrenia),
OfficeVisits = office_visits,
ERvisits = er_visits,
InpatientAdmits = inpatient_admissions,
HbA1c = hba1c,
CD4count = cd4
)
################
# define functions #
####################
# convert logical vector to character
toFactor <- function(x){
return(as.factor(ifelse(as.logical(x) == TRUE, "Yes", "No")))
}
# range standardization
standard_range <- function(x){
(x-min(x))/(max(x)-min(x))
}
# converts Yes/No to 1/0
yes2one <- function(x){
return(ifelse(x =='Yes', 1, 0))
}
######################
# load & format data #
######################
rawDF <- read.csv('data/ehr_dataset.csv')
df <- read.csv('data/ehr_dataset.csv', fill = TRUE) %>%
mutate(Name = name,
VLS = toFactor(vls),
DM = toFactor(dx_diabetes),
DrugAbuse =toFactor(dx_alcoholism),
AlcoholAbuse = toFactor(dx_drug_abuse),
UnstableHousing = toFactor(unstable_housing),
NewDx = toFactor(new_dx),
HCV = toFactor(dx_hcv),
HTN = toFactor(dx_hypertension),
CVD = toFactor(dx_cardiovascular.disease),
CKD = toFactor(dx_ckd),
Depression = toFactor(dx_depression),
Anxiety = toFactor(dx_anxiety),
Schizophrenia = toFactor(dx_schizophrenia),
OfficeVisits = office_visits,
ERvisits = er_visits,
InpatientAdmits = inpatient_admissions,
HbA1c = hba1c,
CD4count = cd4
)
# remove duplicate patients
df <- df[!duplicated(df),]
# care indiciators for the tool
df <- df[,c('Name',"VLS","DM","DrugAbuse","AlcoholAbuse","UnstableHousing","NewDx","HCV","HTN","CVD",
"CKD","Depression","Anxiety","Schizophrenia","HbA1c", "CD4count", "OfficeVisits", "ERvisits",
"InpatientAdmits")]
# shuffle order of dataframe
df <- df[sample(nrow(df)), ]
# get all cvariable names (excluding name)
variables = colnames(df)[-c(1:length(colnames))]
variables
runApp('basic_registry_app.R')
runApp('basic_registry_app.R')
runApp('basic_registry_app.R')
mylist
mylist[c('first', 'fourth')]
runApp('basic_registry_app.R')
runApp('basic_registry_app.R')
mylist + 'dick'
c('name', mylist)
names(df)
runApp('basic_registry_app.R')
runApp('basic_registry_app.R')
?tibble
?rownames_to_column
runApp('basic_registry_app.R')
runApp('basic_registry_app.R')
runApp('consolidated_registry_app.R')
runApp('consolidated_registry_app.R')
runApp('basic_registry_app.R')
library(shinyjqui)
library(DT)
library(shinythemes)
library(dplyr)
library(d3heatmap)
library(ggplot2)
library(plotly)
library(fields)
library(RColorBrewer)
library(sortable)
library(shinydashboard)
library(shinyWidgets)
####################
# define functions #
####################
# convert logical vector to character
toFactor <- function(x){
return(as.factor(ifelse(as.logical(x) == TRUE, "Yes", "No")))
}
# range standardization
standard_range <- function(x){
(x-min(x))/(max(x)-min(x))
}
# converts Yes/No to 1/0
yes2one <- function(x){
return(ifelse(x =='Yes', 1, 0))
}
# converts Yes/No to 1/0
yes2zero <- function(x){
return(ifelse(x =='Yes', 0, 1))
}
# computes MAGIQ weights for an ordered list of arbitrary length
magiqWeights <- function(list){
weights <- c()
for (i in 1:length(list)){
weights[i] <- (1/i)/length(list)
}
return(weights)
}
# computes weighted sum for patients in dataframe
computeWeightedSum <- function(X, orderList){
# computes MAGIQ weights for an ordered list of arbitrary length
weights <- magiqWeights(orderList)
# compute weighted sum for each patient
weightSum <- 0
# for each variable in orderList
for (i in 1:length(orderList)){
# isolate & normalize variable
if (orderList[i] %in% c("DM","DrugAbuse","AlcoholAbuse","UnstableHousing","NewDx","HCV","HTN","CVD",
"CKD","Depression","Anxiety","Schizophrenia")){
vector <- yes2one(X[orderList[i]])
} else if (orderList[i] %in% c("VLS")){
vector <- yes2zero(X[orderList[i]])
} else if (orderList[i] %in% c("OfficeVisits", "CD4count")){
vector = 1- (ntile(X[orderList[i]], 100)/100)
} else if (orderList[i] %in% c("ERvisits","InpatientAdmits", "HbA1c")){
vector = ntile(X[orderList[i]], 100)/100
} else {
print(paste(orderList[i], "-", "variable error"))
vector <- X[orderList[i]]
}
# multiply normalized varible by respective MAGIQ weight
weighted_vector <-standard_range(vector)*weights[i]
# add normalized weighted vector to priority score
weightSum <- weightSum + weighted_vector
}
# bizarre behavior for encounter variables; this fixes bug
if (is.null(dim(weightSum))) {
return(weightSum)
} else {
return(weightSum[,1])
}
}
# generates list for dplyr::arrange
formatSort <- function(selectedOrder){
myList <- c()
# loop over each column in selectedOrder
for(i in 1:length(selectedOrder)){
myList <-c(myList, paste('desc(',selectedOrder[i],')', sep = ''))
}
# return unquoted objects
return(
print(as.name(paste(myList, collapse=', ')))
)
}
######################
# load & format data #
######################
rawDF <- read.csv('data/ehr_dataset.csv')
df <- read.csv('data/ehr_dataset.csv', fill = TRUE) %>%
mutate(Name = name,
VLS = toFactor(vls),
DM = toFactor(dx_diabetes),
DrugAbuse =toFactor(dx_alcoholism),
AlcoholAbuse = toFactor(dx_drug_abuse),
UnstableHousing = toFactor(unstable_housing),
NewDx = toFactor(new_dx),
HCV = toFactor(dx_hcv),
HTN = toFactor(dx_hypertension),
CVD = toFactor(dx_cardiovascular.disease),
CKD = toFactor(dx_ckd),
Depression = toFactor(dx_depression),
Anxiety = toFactor(dx_anxiety),
Schizophrenia = toFactor(dx_schizophrenia),
OfficeVisits = office_visits,
ERvisits = er_visits,
InpatientAdmits = inpatient_admissions,
HbA1c = hba1c,
CD4count = cd4
)
# remove duplicate patients
df <- df[!duplicated(df),]
# care indiciators for the tool
df <- df[,c('Name',"VLS","DM","DrugAbuse","AlcoholAbuse","UnstableHousing","NewDx","HCV","HTN","CVD",
"CKD","Depression","Anxiety","Schizophrenia","HbA1c", "CD4count", "OfficeVisits", "ERvisits",
"InpatientAdmits")]
# shuffle order of dataframe
df <- df[sample(nrow(df)), ]
# get all cvariable names (excluding name)
variables = colnames(df)[-c(1:length(colnames))]
names(variables) <- c('Virally Suppressed', 'Diabetes', 'Active Drug Use', 'Alcoholism', 'Unstable Housing', 'New HIV Diagnosis',
'Chronic HCV', 'Hypertension', 'Cardiovascular Disease', 'Chronic Kidney Disease', 'Major Depression',
'Anxiety Disorder', 'Schizophrenia', 'Most recent HbA1c value', 'Most recent CD4 count', '# Office visits',
'# Emergency Room visits', '# Inpatient admissions')
variables
names(variables
)
names(variables)[-"Virally Suppressed"]
names(variables)[!"Virally Suppressed"]
names(variables)[1]
names(variables)[-11]
names(variables)[-1]
names(variables)[-1, -2]
names(variables)[c(-1, -2)]
names(variables)[c(-1, -3)]
names(variables)[c(-1, -3)]
names(variables)[c(1, 3)]
variables[names(variables)[c(1, 3)]]
runApp('panelViz_app.R')
runApp('panelViz_app.R')
runApp('panelViz_app.R')
names(df)
c('Name', names(variables))
runApp('panelViz_app.R')
library(shiny); runApp('panelViz_app.R')
